<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Political Polarization in North Carolina</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Cabin:700' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:700|Work+Sans:300|Work+Sans:500" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/grayscale.min.css" rel="stylesheet">

    <!-- favicon -->
    <link rel="icon" type="image/png" href="img/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="img/favicon-16x16.png" sizes="16x16">
	
	<!-- reference to Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>
    
    <!-- reference to Leaflet JavaScript Library -->
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>

    <!-- reference to Highcharts -->
    <script src="https://code.highcharts.com/highcharts.js"></script>
	<script src="https://code.highcharts.com/modules/exporting.js"></script>
	<script src="https://code.highcharts.com/modules/export-data.js"></script>

    <!-- reference to label plugin -->
    <link href="leaflet_label/Leaflet.label-0.8">


  </head>

  <body id="page-top">


    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
      <div class="container">
        <a class="navbar-brand js-scroll-trigger" href="#page-top">Home</a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          Menu
          <i class="fa fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#elections">Elections</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#data">Sources</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#contact">Contact</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Intro Header -->
    <header class="masthead">
      <div class="intro-body">
        <div class="container">
          <div class="row">
            <div class="col-lg-8 mx-auto">
              <h1 class="brand-heading" style="font-size: 4.5em">North Carolina's Polarization Problem</h1>
              <h2 style="font-family: Work Sans, Helvetica; font-weight: 300">and its evolution through time</h2>
              <a href="#elections" class="btn btn-circle js-scroll-trigger">
                <i class="fa fa-angle-double-down animated"></i>
              </a>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- 2000 Election Section -->
    <section id="elections" class="elections-section text-center">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 mx-auto">
			      <h2 style="padding-top: 2em; margin-bottom: 10px">American Political Polarization</h2>
              <h6 style="font-family: Work Sans, Helvetica; font-weight: 300; margin-top: 0px; margin-bottom: 15px">Considering Space</h6>
            
                <p style="text-align: left"><br><br>By all accounts, the United States is dealing with an increasingly vitriolic, polarized political system. Political polarization has grabbed the attention of media outlets across the political spectrum: <em>Vox.com</em> ran a <a href="https://www.vox.com/the-big-idea/2017/9/5/16227700/hyperpartisanship-identity-american-democracy-problems-solutions-doom-loop target="_blank"">headline</a> in September 2017 warning that “rabid partisanship could destroy American democracy” while  <em>Breitbart</em> <a href=http://www.breitbart.com/big-government/2017/12/21/poll-documents-polarization-country-two-opposing-world-views/ target="_blank">reported</a> that a “poll document[ed] polarization of country into two opposing world views.” <br><br>

                Perhaps to no one’s surprise, Pew Research Center <a href="http://www.people-press.org/2017/10/05/the-partisan-divide-on-political-values-grows-even-wider/." target="_blank">found</a> that since 1994, the partisan gap between Democrats and Republicans nationwide has jumped from 15 points to 36 points, a record high since the survey was first conducted.
			          <br><br>

			          Investigations such as the surveys undertaken by Pew Research Center provide valuable data that assess the attitude of the electorate, but offer only a bird’s eye view of American politics by privileging reported attitudes and non-spatial statistics over outcomes of elections and smaller-scale spatial data. <br><br>

			          Taking a more geographic approach, John Agnew and Luca Muscará (two political geographers) assert that, <b>“not only is American politics increasingly polarized ideologically, but the country itself is increasingly geographically polarized politically, albeit not at the state level of sections or macroregions, but at the scale of counties, suburbs, and municipalities.”</b><br><br>

                Let's take a look two elections in North Carolina &ndash; the 2000 and 2016 presidential elections &ndash; to examine the evolution of spatial-political polarization in the state. 
			          </p>

            <h2 style="padding-top: 2em; margin-bottom: 10px">2000 Presidential Election</h2>
            <h6 style="font-family: Work Sans, Helvetica; font-weight: 300; margin-top: 0px; margin-bottom: 15px">George W. Bush* (R) & Al Gore (D)</h6>
			     
          <div id='map2'></div>
          <div id="info_container2"></div>
          <div id="legend_container2"></div>
          <br></br>
          <p><b>2000 Total Traditional Landslide Counties</b>: 51<br>(40 Republican wins, 11 Democratic wins)<br><br><b>2000 Total Mega-Landslide Counties</b>: 6<br>(all Republican wins)
          </p><br>

          <p style="text-align: left">A helpful metric for considering polarization is the landslide victory, which is defined by Bill Bishop in his book <em>The Big Sort</em> as an election where one candidate wins by more than 20 points (FiveThirtyEight also <a href="https://fivethirtyeight.com/features/purple-america-has-all-but-disappeared/" target="_blank">considers</a> elections with margins higher than 20 points to be a landslide.)</p>

		<p style="text-align: left">The problem with such a definition, however, is that it conceals the heterogeneity of landslide counties. While some margins sit just above 20 points, others soar beyond 60 (a point also highlighted by the above FiveThirtyEight <a href="https://fivethirtyeight.com/features/purple-america-has-all-but-disappeared/" target="_blank">piece</a>). </p>	

		<p style="text-align: left">It's useful to add an additional category: the mega-landslide, or an election where the margin of victory exceeds 40 points. In the above map of the 2000 presidential election, there are 51 traditional landslide counties (78% of which were Republican, and the other 22% were Democratic). Of the 51 landslide counties, 6 are mega-landslides. Since 2000, both the numbers of traditional landslide counties and mega-landslide counties have increased dramatically.</p>	

    <div id="pie2000"></div><br><br>			          


          

<script type="text/javascript" src="json/nc_2000p.geojson"></script>
<script type="text/javascript">


// Leaflet Code Map 2
// Create second map variable 
var map2 = L.map('map2', { zoomControl:false }).setView([34.980061, -79.920941], 3);

L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
	maxZoom: 6.45,
	minZoom: 6.45,
	zoomSnap: 1,
	attribution: 'Map data from <a href="https://www.census.gov/geo/maps-data/data/cbf/cbf_counties.html" target="_blank">U.S. Census Bureau</a> + ' + '<a href="https://www.american.edu/spa/ccps/data-sets.cfm" target="_blank">AU School of Public Affairs</a>' ,
	id: 'mapbox.dark'
}).addTo(map2);
console.log("map loaded")

// control that shows state info on hover
var info2 = L.control();

info2.onAdd = function(map2) {
	this._div = L.DomUtil.create('div', 'info2');
	this.update();
	return this._div; 
}
console.log("info function one added")


// Election results + margin of victory
info2.update = function(props) {
	this._div.innerHTML = '<h4>Results</h4>' + (props ? '<h3>' + props.NAME + ' County</h3><br>' + '<h6>Gore: ' + props.demp2000 + '%<br>' + 'Bush: ' + props.gopp2000 + '%<br>' + 'Margin: ' + Math.abs(props.movp2000) + ' pts</h6>'
	:'<br><h5>Hover over a county</h5>');
};

info2.addTo(map2);

// second geojson file

var geojson2 = L.geoJson(Elec00, {style: style}).addTo(map2);
// console.log(geojson2.getLayers().length);
// console.log(Elec00.features.length);
				
function style(feature) {
	return {
	fillColor: getColor(feature.properties.movp2000),
	weight: 1.5,
	opacity: .5,
	color: '#eeeeee',
	fillOpacity: 1
	}
}; 

// add colors to each county
	function getColor(d) {
  	return d > 40 ? '#3c7cc6' :
      d > 20 ? '#81a8d9' :
      d > 0 ? '#c0d4e9' :
      d > -20 ? '#e5c3c3' :
      d > -40 ? '#d48c8b' :
           '#b51f1d' ;
}

// control hover features / colors 
function highlightFeature(e) {
	var layer = e.target;
	layer.setStyle({
		weight: 5,
		color: '#000',
		dashArray: '',
		fillOpacity: 1.5
	});
				
	if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
			layer.bringToFront();
	};

info2.update(layer.feature.properties);
}

function resetHighlight(e) {
	geojson2.resetStyle(e.target);
}

console.log(highlightFeature)

function onEachFeature(feature, layer) {
	layer.on({
		mouseover: highlightFeature,
		mouseout: resetHighlight
	});
}

var geojson2 = L.geoJson(Elec00, {
	style: style,
	onEachFeature: onEachFeature
}).addTo(map2);

var icon = L.Icon.extend({
  options: {
    iconSize:     [10, 10],
    iconAnchor:   [5, 5],
    popupAnchor:  [0, 0]
  }
});

// add points to the map (cities)
var point = new icon({iconUrl: 'img/dot-circle.svg'});
  L.marker([35.2271, -80.8431], {icon: point})
  	.bindTooltip("Charlotte")
   	.openTooltip(map2)
   	.addTo(map2);
  L.marker([35.796, -78.6382], {icon: point})
   	.bindTooltip("Raleigh")
   	.openTooltip(map2)
   	.addTo(map2);
  L.marker([35.5951, -82.5515], {icon: point})
   	.bindTooltip("Asheville")
  	.openTooltip(map2)
  	.addTo(map2);
  L.marker([36.0726, -79.7920], {icon: point})
  	.bindTooltip("Greensboro")
  	.openTooltip(map2)
  	.addTo(map2);

// legend controls 
var legend = L.control({position: 'bottomright'});

legend.onAdd = function (map) {

  var div = L.DomUtil.create('div', 'info legend'),
    grades = [-60, -40, -20, 0, 20, 40],
    labels = ["<b>Margin of Victory (pts)</b>"],
  from, to;
  
  // create the llabel variable for the legend
  for (var i = 0; i < grades.length; i++) {
    from = grades[i];
    to = grades[i + 1];
            
  if(grades[i] < 0) {
    party = 'GOP'
  } else {
    party = 'Dem'
  }

  if (grades[i] < -40) {
  	llabel = '(40+)'
  }	else if (grades[i] < -20) {
  	llabel = '(20-40)'
  }	else if (grades[i] < 0) {
  	llabel = '(0-20)'
  }	else if (grades[i] > 40) {
  	llabel = '(0-20)'
  }	else if (grades[i] > 20) {
  	llabel = '(40+)'
  }	else if (grades[i] > 0) {
  	llabel = '(20-40)'
  }

labels.push(
  '<i style="background:' + getColor(from + 1) + '"></i>'+ party + ' ' + llabel);

  }

div.innerHTML = labels.join('<br>');
return div;
};

legend.addTo(map2);

var htmlObject = info2.getContainer();
// Get the desired parent node.
var a = document.getElementById('info_container2');

function setParent(el, newParent)
{
    newParent.appendChild(el);
}
setParent(htmlObject, a);

var htmlObjectL = legend.getContainer();
// Get the desired parent node.
var b = document.getElementById('legend_container2');

function setParent(el, newParent)
{
    newParent.appendChild(el);
}
setParent(htmlObjectL, b);

</script>

<br>
          </div>
        </div>
      </div>
    </section>

<hr />

<!-- 2016 Presidential Section -->
  
    <section id="elections" class="elections-section text-center">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 mx-auto">
            <h2 style="padding-top: 2em; margin-bottom: 10px">2016 Presidential Election</h2>
              <h6 style="font-family: Work Sans, Helvetica; font-weight: 300; margin-top: 0px; margin-bottom: 15px">Donald Trump* (R) & Hillary Clinton (D)</h6>
            
            <!--MAP DIV-->
            <div id='map'></div>
            <div id="info_container"></div>
            <div id="legend_container"></div>
            <br><br>
            	
            
            <div><p><b>2016 Total Traditional Landslide Counties</b>: 63<br>(52 Republican wins, 11 Democratic wins)<br><br><b>2016 Total Mega-Landslide Counties</b>: 26<br>(24 Republican wins, 2 Democratic wins)
            </p></div>

            <div id="pie2016" style="width: 100%"></div>

            <br><p style="text-align: left">From 2000 to 2016, the total number of landslide counties jumped from 51 to 63, resulting in an increase of approximately 20%. More notably, the number of mega-landslide counties leapt 433%, from 6 to 26, and heavily favor the Republican candidate (this trend is clearly demonstrated in the graphic below). Nearly 83% of all the landslide counties (traditional and mega-landslides) were won by Donald Trump, and an overwhelming majority of mega-landslides were red as well (92%). </p>

            <div id="stackedbar"></div><br>

            <p style="text-align: left">Such a trend could be explained by any number of forces: collective movement to the right on the part of the Republican party, a shift of Democratic voters out of traditionally conservative areas to urban cores (which are perhaps not coincidentally Democratic strongholds), successful efforts to get out the Republican vote, or successful efforts to stifle the Democratic vote in the state (check out what the Atlantic has to say on that <a href="https://www.theatlantic.com/politics/archive/2016/11/north-carolina-early-voting/506963/" target="_blank">here</a>). 
            </p>

            <p style="text-align: left">Also of interest is the distribution of people among those counties, and simply showing the election results betrays another layer of complexity. In the chart below, you'll find the percentage of the total population of each county (based on July 2015 <a href="https://files.nc.gov/ncosbm/demog/countygrowth_2015.html" target="_blank">estimates</a>) in the state of North Carolina compared to the proportion of each county type. For example, Democratic Mega-Landslide counties comprised only 2% of North Carolina's counties, but those counties hold 4.35% of the state's total population. It's evident then that despite few Democratic county-level victories, Democratic counties tend to be more vote rich and represent more constituents than their Republican counterparts.</p><br>

            <div id="stackedarea"></div>

            <br><p style="text-align: left">That elections are becoming less competitive should certainly raise flags among party leaders and the public. Spatial-political polarization and the resulting reality that leaves us in increasingly homogenous political communities is a problematic prospect, given the tendency of like-minded groups to grow more reticent to consider alternative points of view with passing time. Check out the third chapter of Bishop's <em>The Big Sort</em> called "The Psychology of the Tribe" for additional explanation + more resources to explore.<br><br>
          </p>

<!--
<div id="chart">
  <svg></svg>
</div>

<script type="text/javascript">
            //Donut chart example
nv.addGraph(function() {
  var chart = nv.models.pieChart()
      .x(function(d) { return d.label })
      .y(function(d) { return d.value })
      .showLabels(true);

    d3.select("#chart svg")
        .datum(data)
      .transition().duration(1200)
        .call(chart);

  return chart;
});
</script>
-->
<style> 
	.leaflet-container {
		background-color:rgba(255,0,0,0.0);
	}
</style>

<script type="text/javascript" src="json/nc_2016p_2.geojson"></script>
<script type="text/javascript">

// Highcharts code

var electionColors = ['#3c7cc6', '#81a8d9', '#c0d4e9', '#e5c3c3', '#d48c8b', '#b51f1d'];

var pie2016 = new Highcharts.chart({
    chart: {
    	renderTo: 'pie2016',
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false,
        type: 'pie',
        style: {
        	fontFamily: 'Work Sans',
        },
        spacingBottom: 0,
        spacingTop: 0,
        marginTop: 0,
        margin: 0,
        height: 300
    },
    title: {
        text: null
    },
    tooltip: {
        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
    },
    plotOptions: {
        pie: {
            allowPointSelect: true,
            cursor: 'pointer',
            dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                // style: {
                //     color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                // }
            }
        }
    },
    series: [{
        name: 'Election Results',
        data: [{
            name: 'GOP Mega-Landslide',
            y: 24,
            color: electionColors[5]
        }, {
            name: 'GOP Landslide',
            y: 28,
            color: electionColors[4]
        }, {
            name: 'Competitive GOP',
            y: 24,
            color: electionColors[3]
        }, {
            name: 'Competitive Dem',
            y: 13,
            color: electionColors[2]
        }, {
            name: 'Dem Landslide',
            y: 9,
            color: electionColors[1]
        }, {
            name: 'Dem Mega-Landslide',
            y: 2,
            color: electionColors[0]
        }]
    }]
});

var pie2000 = new Highcharts.chart({
    chart: {
    	renderTo: 'pie2000',
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false,
        type: 'pie',
        style: {
        	fontFamily: 'Work Sans',
        },
        spacingBottom: 0,
        spacingTop: 0,
        marginTop: 0,
        height: 300,
    },
    position: {
      align: 'center'
    },
    title: {
        text: null
    },
    tooltip: {
        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
    },
    plotOptions: {
        pie: {
            allowPointSelect: true,
            cursor: 'pointer',
            dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                // style: {
                //     color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                // }
            }
        }
    },
    series: [{
        name: 'Election Results',
        data: [{
            name: 'GOP Mega-Landslide',
            y: 6,
            color: electionColors[5]
        }, {
            name: 'GOP Landslide',
            y: 34,
            color: electionColors[4]
        }, {
            name: 'Competitive GOP',
            y: 35,
            color: electionColors[3]
        }, {
            name: 'Competitive Dem',
            y: 14,
            color: electionColors[2]
        }, {
            name: 'Dem Landslide',
            y: 11,
            color: electionColors[1]
        }]
    }]
});

var stackedbar = new Highcharts.chart({
  chart: {
      renderTo: 'stackedbar',
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false,
        type: 'column',
        style: {
          fontFamily: 'Work Sans',
        },
        spacingBottom: 0,
        spacingTop: 0,
        marginTop: 75,
        marginBottom: 75,
        height: 350,
    },
        title: {
        text: 'Breakdown of Presidential Electoral Results'
    },
    xAxis: {
        categories: ['2000', '2004', '2008', '2012', '2016']
    },
    yAxis: {
        min: 0,
        max: 100,
        title: {
            text: 'North Carolina counties',
        },
        stackLabels: {
            enabled: true,
            style: {
                fontWeight: 'bold',
                color: (Highcharts.theme && Highcharts.theme.textColor) || 'gray'
            }
        }
    },
    legend: {
        align: 'right',
        x: -30,
        verticalAlign: 'top',
        y: 25,
        floating: true,
        backgroundColor: (Highcharts.theme && Highcharts.theme.background2) || 'white',
        borderColor: '#fff',
        borderWidth: 1,
        shadow: false
    },
    tooltip: {
        headerFormat: '<b>{point.x}</b><br/>',
        pointFormat: '{series.name}: {point.y}'
    },
    plotOptions: {
        column: {
            stacking: 'normal',
            dataLabels: {
                enabled: true,
                color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'white'
            }
        }
    },
    series: [{
        name: 'GOP Mega-Landslide',
        data: [6, 11, 4, 14, 24],
        color: electionColors[5]
    }, {
        name: 'GOP Landslide',
        data: [34, 37, 30, 27, 28],
        color: electionColors[4]
    }, {
        name: 'Competitive GOP',
        data: [35, 32, 33, 29, 24],
        color: electionColors[3]
    }, {
        name: 'Dem Mega-Landslide',
        data: [0, 0, 3, 3, 2],
        color: electionColors[0]
    }, {
        name: 'Dem Landslide',
        data: [11, 7, 8, 9, 9],
        color: electionColors[1]
    }, {
        name: 'Competitive Dem',
        data: [14, 13, 22, 18, 13],
        color: electionColors[2]
    }]
  });

var stackedarea = new Highcharts.chart({
    chart: {
        renderTo: 'stackedarea',
        type: 'bar',
        style: {
          fontFamily: 'Work Sans',
        },
        spacingLeft: 5,
        marginLeft: 150,
    },
    title: {
        text: 'Electoral Results vs. Total Population in 2016'
    },
    xAxis: {
        categories: ['GOP Mega-Landslide', 'GOP Landslide', 'Competitive GOP', 'Competitive Dem', 'Dem Landslide', 'Dem Mega-Landslide'],
        title: {
            text: null
        }
    },
    yAxis: {
        min: 0,
        title: {
            text: 'Percantage of Total',
            align: 'high'
        },
        labels: {
            overflow: 'justify'
        }
    },
    tooltip: {
        valueSuffix: ' %'
    },
    plotOptions: {
        bar: {
            dataLabels: {
                enabled: true
            }
        }
    },
    legend: {
        layout: 'vertical',
        align: 'right',
        verticalAlign: 'bottom',
        x: -40,
        y: 80,
        floating: true,
        borderWidth: 1,
        backgroundColor: ((Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF'),
        shadow: true
    },
    credits: {
        enabled: false
    },
    series: [{
        name: '% of Total Counties',
        data: [24, 28, 24, 13, 9, 2],
        color: '#00A896'
    }, {
        name: '% of Statewide Population',
        data: [15.58, 25.28, 12.06, 20.05, 22.68, 4.35],
        color: '#05668D'
    }]
});

// Leaflet Code
// Create the map variable
				
var map = L.map('map', { zoomControl:false }).setView([34.980061, -79.920941], 3);

L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
	maxZoom: 6.45,
	minZoom: 6.45,
	zoomSnap: 1,
	attribution: 'Map data from <a href="https://www.census.gov/geo/maps-data/data/cbf/cbf_counties.html" target="_blank">U.S. Census Bureau</a> + ' + '<a href="https://uselectionatlas.org/" target="_blank">Election Atlas by Dave Leip</a>' ,
	id: 'mapbox.dark'
}).addTo(map);
console.log("map loaded")

  

// to control what shows up when you hover

var info = L.control();

info.onAdd = function(map) {
  this._div = L.DomUtil.create('div', 'info');
	this.update();
	return this._div; 
}

// election results + margin of victory

info.update = function(props) {
	this._div.innerHTML = '<h4>Results</h4>' + (props ? '<h3>' + props.COUNTYNAME + ' County</h3><br>' + '<h6>Clinton: ' + props.demp2016 + '%<br>' + 'Trump: ' + props.gopp2016 + '%<br>' + 'Margin: ' + Math.abs(props.movp2016) + ' pts</h6>'
	:'<br><h5>Hover over a county</h5>');
};
info.addTo(map);

// var popup16 = L.popup();
// geojson.on('')
  // .setLatLng(latlng)
  // .setContent('<h4>Results</h4>' + (props ? '<h3>' + props.COUNTYNAME + ' County</h3><br>' + '<h6>Clinton: ' + props.demp2016 + '%<br>' + 'Trump: ' + props.gopp2016 + '%<br>' + 'Margin: ' + Math.abs(props.movp2016) + ' pts</h6>'
  // :'<br><h5>Hover over a county</h5>'))
  // .openOn(map);

var geojson = L.geoJson(pElec16, {style: style}).addTo(map);
console.log(geojson.getLayers().length);
console.log(pElec16.features.length);

// add colors to each county
	function getColor(d) {
  	return d > 40 ? '#3c7cc6' :
      d > 20 ? '#81a8d9' :
      d > 0 ? '#c0d4e9' :
      d > -20 ? '#e5c3c3' :
      d > -40 ? '#d48c8b' :
           '#b51f1d' ;
}

// hover and color characteristics				

function style(feature) {
	return {
		fillColor: getColor(feature.properties.movp2016),
		weight: 1.5,
		opacity: .5,
		color: '#eeeeee',
		fillOpacity: 1
	};
}

L.geoJson(pElec16, {style: style}).addTo(map); 

function highlightFeature(e) {
  var layer = e.target;

  layer.setStyle({
		weight: 5,
		color: '#000',
		dashArray: '',
		opacity: .5,
		fillOpacity: 1.5
  });
				
  if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
	  layer.bringToFront();
  }

  info.update(layer.feature.properties);
}

function resetHighlight(e) {
	geojson.resetStyle(e.target);
}

console.log(highlightFeature)
					
function onEachFeature(feature, layer) {
	layer.on({
		mouseover: highlightFeature,
		mouseout: resetHighlight
	});
}

var geojson = L.geoJson(pElec16, {
	style: style,
	onEachFeature: onEachFeature
}).addTo(map);

// controls for the cities on the map
// icon controls 

var icon = L.Icon.extend({
  options: {
    iconSize:     [10, 10],
    iconAnchor:   [5, 5],
    popupAnchor:  [0, 0]
  }
});


// labels for each point
var point = new icon({iconUrl: 'img/dot-circle.svg'});
  L.marker([35.2271, -80.8431], {icon: point})
    .bindTooltip("Charlotte")
    .openTooltip(map)
    .addTo(map);
  L.marker([35.796, -78.6382], {icon: point})
    .bindTooltip("Raleigh")
    .openTooltip(map)
    .addTo(map);
  L.marker([35.5951, -82.5515], {icon: point})
    .bindTooltip("Asheville")
    .openTooltip(map)
    .addTo(map);
  L.marker([36.0726, -79.7920], {icon: point})
    .bindTooltip("Greensboro")
    .openTooltip(map)
    .addTo(map);

// legend controls 
var legend = L.control({position: 'bottomright'});

legend.onAdd = function (map) {

  var div = L.DomUtil.create('div', 'info legend'),
    grades = [-60, -40, -20, 0, 20, 40],
    labels = ["Margin of Victory (pts)"],
    from, to;

  // modify the legend labels
  for (var i = 0; i < grades.length; i++) {
    from = grades[i];
    to = grades[i + 1];
            
    if(grades[i] < 0) {
      party = 'GOP'
    } 
    else {
      party = 'Dem'
    }

  // create the llabel field for the legend
  if (grades[i] < -40) {
      llabel = '(40+)'
    }	else if (grades[i] < -20) {
      llabel = '(20-40)'
    }	else if (grades[i] < 0) {
      llabel = '(0-20)'
    }	else if (grades[i] > 40) {
      llabel = '(0-20)'
    }	else if (grades[i] > 20) {
      llabel = '(40+)'
    }	else if (grades[i] > 0) {
      llabel = '(20-40)'
    }

  // create the labels
  labels.push(
      '<i style="background:' + getColor(from + 1) + '"></i>'+ party + ' ' + llabel);
  }

  div.innerHTML = labels.join('<br>');
  return div;
};

legend.addTo(map);

var htmlObject = info.getContainer();
// Get the desired parent node.
var c = document.getElementById('info_container');

function setParent(el, newParent)
{
    newParent.appendChild(el);
}
setParent(htmlObject, c);

var htmlObjectL = legend.getContainer();
// Get the desired parent node.
var d = document.getElementById('legend_container');

function setParent(el, newParent)
{
    newParent.appendChild(el);
}
setParent(htmlObjectL, d);

</script>


          </div>
        </div>
      </div>
    </section>
    <hr />

    <!-- Data Section -->
    <section id="data" class="data-section content-section text-center">
      <div class="container">
        <div class="col-lg-8 mx-auto">

          <h2 style="margin-top: -3.6em">Sources & Data</h2>
            <h6 style="font-family: Work Sans, Helvetica; font-size: 1.1em; font-weight: 300; margin-top: 0px; margin-bottom: 15px; letter-spacing: 0px">Sources</h6>

          		<p style="text-align: left; font-size: 1em; padding-bottom: -.5em">
                Agnew, John, and Luca Muscarà. 2012. <a href="https://www.amazon.com/Making-Political-Geography-John-Agnew/dp/1442212306" target="_blank">Making Political Geography</a>. John Agnew + Luca Muscarà. 2012. Plymouth: Rowman & Littlefield Publishers, Inc.<br><br>
        				Drutman, Lee. <a href="https://www.vox.com/the-big-idea/2017/9/5/16227700/hyperpartisanship-identity-american-democracy-problems-solutions-doom-loop." target="_blank">"Hyperpartisanship could destroy U.S. democracy."</a> <em>Vox.com</em>. September 5, 2017. 
        				<br><br>Hook, Janet. <a href="https://www.wsj.com/articles/political-divisions-in-u-s-are-widening-long-lasting-poll-shows-1504670461" target="_blank">Political Divisions in U.S. Are Widening, Long-Lasting, Poll Shows."</a> <em>Wall Street Journal</em>. September 6, 2017.
        				<br><br>Pew Research Center. <a href="http://www.people-press.org/2017/10/05/the-partisan-divide-on-political-values-grows-even-wider/" target="_blank">The Partisan Divide on Political Values Grows Even Wider."</a> Pew Research Center. October 5, 2017.
      				</p><br>

            <h6 style="font-family: Work Sans, Helvetica; font-size: 1.1em; font-weight: 300; margin-top: 0px; margin-bottom: 15px; letter-spacing: 0px">Other Reading</h6>

              <p style="text-align: left; font-size: 1em; padding-bottom: -.5em">
                Bishop, Bill. 2009. <a href="https://www.amazon.com/Big-Sort-Clustering-Like-Minded-America/dp/0547237723" target="_blank">The Big Sort: Why the Clustering of Like-Minded America is Tearing Us Apart</a>. Mariner Books.<br><br>
                Gimpel, James, and Iris Hui. 2015. "<a href="https://www.sciencedirect.com/science/article/pii/S0962629815000049" target="_blank">Seeking politically compatible neighbors? The role of neighborhood partisan composition in residential sorting.</a>" <em>Political Geography</em> 48: 130-142.<br><br>
                Holbrook, Thomas. 2016. <a href="https://www.amazon.com/Altered-States-Populations-Transformation-Political/dp/0190269138/ref=sr_1_1?s=books&ie=UTF8&qid=1527109967&sr=1-1&keywords=altered+states+holbrook" target="_blank">Altered States: Changing Populations, Changing Parties, and the Transformation of the American Political Landscape</a>. Oxford University Press.</p><br>

            <h6 style="font-family: Work Sans, Helvetica; font-size: 1.1em; font-weight: 300; margin-top: 0px; margin-bottom: 15px; letter-spacing: 0px">Election + Map Data</h6>

          		<p style="text-align: left; font-size: 1em">I pulled the 2016 election data from <a href="https://uselectionatlas.org/" target="_blank">Dave Leip's Election Atlas</a>, the 2000 election data from <a href="https://www.american.edu/spa/ccps/data-sets.cfm" target="_blank">American University's School of Public Affairs</a>, and the shapefiles from the <a href="https://uselectionatlas.org/" target="_blank">U.S. Census Bureau</a>.</p>

            <a href="https://uselectionatlas.org/" class="btn btn-default btn-lg" style="display: none">Dave Leip's Election Atlas</a>
            <a href="https://uselectionatlas.org/" class="btn btn-default btn-lg" style="display: none">U.S. Census Bureau</a>
        </div>
      </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="content-section text-center">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 mx-auto">
            <h2>Thanks for checking out my work.</h2>
            <p>Feel free to reach out with questions or comments at <a href="mailto:katip@uoregon.edu?Subject=Political%20polarization%20in%20North%20Carolina" target="_top">katip@uoregon.edu</a>.<br>For more on what I'm up to, check out my <a href="http://www.katherinefperry.com" target="_blank">portfolio</a>.</p>
            <ul class="list-inline banner-social-buttons">
              <li class="list-inline-item">
                <a href="https://twitter.com/kfperry" class="btn btn-default btn-lg">
                  <i class="fab fa-twitter"></i>

                </a>
              </li>
              <li class="list-inline-item">
                <a href="https://github.com/katherinefperry" class="btn btn-default btn-lg">
                  <i class="fab fa-github"></i>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="https://www.linkedin.com/in/katherine-perry-7b644444/" class="btn btn-default btn-lg">
                  <i class="fab fa-linkedin-in"></i>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Map Section -->
    <div id="map" style="display: none"></div>

    <!-- Footer -->
    <footer>
      <div class="container text-center">
        <p>Copyright &copy; Katherine Perry 2018</p>
      </div>
    </footer>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Google Maps API Key - Use your own API key to enable the map feature. More information on the Google Maps API can be found at https://developers.google.com/maps/ -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCRngKslUGJTlibkQ3FkfTxj3Xss1UlZDA&sensor=false"></script>

    <!-- Custom scripts for this template -->
    <script src="js/grayscale.min.js"></script>

  </body>

</html>
